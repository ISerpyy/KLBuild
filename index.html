<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BTC Port</title>

  <style>
    body{
      font-family: Arial, sans-serif;
      background:#000000;
      color:#fcf9f9;
      padding:30px;

      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .card{
      background:#111b33;
      padding:22px;
      border-radius:16px;
      max-width:560px;
      width: 100%;
      box-shadow:0 0 20px rgba(0,0,0,0.3);
    }
    h1{margin:0 0 10px; text-align:center;}
    .label{opacity:.7;margin-top:16px; text-align:center;}
    .big{font-size:28px;font-weight:bold;margin-top:6px; text-align:center;}
    .small{opacity:.7;font-size:14px;margin-top:14px; text-align:center;}
    .up{color:#7CFC00;}
    .down{color:#ff6b6b;}

    .chartWrap{
      margin-top: 18px;
      background: rgba(255,255,255,0.06);
      border-radius: 14px;
      padding: 12px;
    }
    canvas{
      width: 100%;
      height: 120px;
      display: block;
    }
  </style>
</head>
<body>

<div class="card">
  <h1>BTC</h1>

  <div class="label">You currently hold:</div>
  <div class="big" id="myBtc">0.00 BTC</div>

  <div class="label">Live BTC Price (USD):</div>
  <div class="big" id="btcPriceUsd">Loading...</div>

  <div class="label">Total Value (USD):</div>
  <div class="big" id="totalUsd">$0</div>

  <div class="label">Total Value (GTQ / Quetzales):</div>
  <div class="big" id="totalGtq">Q0</div>

  <div class="chartWrap">
    <div class="small" style="margin-top:0;">Mini chart (last prices)</div>
    <canvas id="miniChart" width="520" height="120"></canvas>
  </div>

  <div class="small" id="status">Connecting...</div>
</div>

<script>
  const MY_BTC = 0.052;
  const USD_TO_GTQ = 7.75;

  /*
    ✅ 
    Normal:
      const LOCK_VALUE = false;
      const LOCKED_PRICE_USD = 0;

    Congelado:
      const LOCK_VALUE = true;
      const LOCKED_PRICE_USD = 89233;
  */
  const LOCK_VALUE = false;
  const LOCKED_PRICE_USD =89266 ;

  const myBtcEl = document.getElementById("myBtc");
  const btcPriceUsdEl = document.getElementById("btcPriceUsd");
  const totalUsdEl = document.getElementById("totalUsd");
  const totalGtqEl = document.getElementById("totalGtq");
  const statusEl = document.getElementById("status");

  myBtcEl.textContent = MY_BTC + " BTC";

  let lastPrice = null;

  function updateTotals(priceUsd) {
    const usedPrice = (LOCK_VALUE === true && LOCKED_PRICE_USD > 0)
      ? LOCKED_PRICE_USD
      : priceUsd;

    const totalUsd = MY_BTC * usedPrice;
    const totalGtq = totalUsd * USD_TO_GTQ;

    totalUsdEl.textContent =
      "$" + totalUsd.toLocaleString(undefined, { maximumFractionDigits: 2 });

    totalGtqEl.textContent =
      "Q" + totalGtq.toLocaleString(undefined, { maximumFractionDigits: 2 });
  }


  const canvas = document.getElementById("miniChart");
  const ctx = canvas.getContext("2d");

  const prices = [];
  const MAX_POINTS = 40;

  function drawChart() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (prices.length < 2) return;

    const min = Math.min(...prices);
    const max = Math.max(...prices);
    const range = (max - min) || 1;

    const padding = 10;
    const w = canvas.width - padding * 2;
    const h = canvas.height - padding * 2;

    // Fondo suave (grid simple)
    ctx.globalAlpha = 0.35;
    ctx.strokeStyle = "white";
    ctx.lineWidth = 1;

    ctx.beginPath();
    ctx.moveTo(padding, padding + h/2);
    ctx.lineTo(padding + w, padding + h/2);
    ctx.stroke();

    ctx.globalAlpha = 1;

    // Línea del chart
    ctx.beginPath();
    for (let i = 0; i < prices.length; i++) {
      const x = padding + (i / (prices.length - 1)) * w;
      const normalized = (prices[i] - min) / range;
      const y = padding + (1 - normalized) * h;

      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    }

    ctx.strokeStyle = "white";
    ctx.lineWidth = 2;
    ctx.stroke();

    // Puntito del último precio
    const last = prices[prices.length - 1];
    const lastX = padding + w;
    const lastY = padding + (1 - ((last - min) / range)) * h;

    ctx.beginPath();
    ctx.arc(lastX, lastY, 3.5, 0, Math.PI * 2);
    ctx.fillStyle = "white";
    ctx.fill();
  }

  function addPriceToChart(priceUsd) {
    prices.push(priceUsd);
    if (prices.length > MAX_POINTS) prices.shift();
    drawChart();
  }

  async function fetchLivePrice() {
    try {
      const res = await fetch(
        "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd",
        { cache: "no-store" }
      );

      const data = await res.json();
      const priceUsd = data.bitcoin.usd;

      btcPriceUsdEl.textContent =
        "$" + priceUsd.toLocaleString(undefined, { maximumFractionDigits: 2 });

      if (lastPrice !== null) {
        if (priceUsd > lastPrice) statusEl.className = "small up";
        else if (priceUsd < lastPrice) statusEl.className = "small down";
        else statusEl.className = "small";
      }

      lastPrice = priceUsd;

      updateTotals(priceUsd);
      addPriceToChart(priceUsd);

      statusEl.textContent = "Last update: " + new Date().toLocaleTimeString();
    } catch (err) {
      statusEl.className = "small down";
      statusEl.textContent = "Error: Could not fetch BTC price (internet/API).";
    }
  }

  fetchLivePrice();
  setInterval(fetchLivePrice, 5000);
</script>

</body>
</html>


























